<%- include('partials/header') %>

<div class="row mb-4">
  <div class="col">
    <h2><i class="fas fa-tachometer-alt"></i> Dashboard</h2>
    <p class="text-muted">Welcome back, <%= user.name %>!</p>
  </div>
</div>

<div class="row g-4">
  <div class="col-md-4">
    <div class="card text-white bg-primary">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h6 class="card-title">Total Vehicles</h6>
            <h2 id="totalVehicles">-</h2>
          </div>
          <i class="fas fa-car fa-3x opacity-50"></i>
        </div>
      </div>
      <div class="card-footer bg-transparent">
        <a href="/vehicles" class="text-white text-decoration-none">
          View Details <i class="fas fa-arrow-right"></i>
        </a>
      </div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="card text-white bg-success">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h6 class="card-title">Available Vehicles</h6>
            <h2 id="availableVehicles">-</h2>
          </div>
          <i class="fas fa-check-circle fa-3x opacity-50"></i>
        </div>
      </div>
      <div class="card-footer bg-transparent">
        <a href="/vehicles" class="text-white text-decoration-none">
          View Available <i class="fas fa-arrow-right"></i>
        </a>
      </div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="card text-white bg-warning">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h6 class="card-title">Active Rentals</h6>
            <h2 id="activeRentals">-</h2>
          </div>
          <i class="fas fa-file-contract fa-3x opacity-50"></i>
        </div>
      </div>
      <div class="card-footer bg-transparent">
        <a href="/rentals" class="text-white text-decoration-none">
          View Rentals <i class="fas fa-arrow-right"></i>
        </a>
      </div>
    </div>
  </div>

  <% if (user.role === 'admin') { %>
  <div class="col-md-4">
    <div class="card text-white bg-info">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h6 class="card-title">Total Customers</h6>
            <h2 id="totalCustomers">-</h2>
          </div>
          <i class="fas fa-users fa-3x opacity-50"></i>
        </div>
      </div>
      <div class="card-footer bg-transparent">
        <a href="/customers" class="text-white text-decoration-none">
          View Customers <i class="fas fa-arrow-right"></i>
        </a>
      </div>
    </div>
  </div>
  <% } %>

  <div class="col-md-4">
    <div class="card text-white bg-danger">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h6 class="card-title">Overdue Rentals</h6>
            <h2 id="overdueRentals">-</h2>
          </div>
          <i class="fas fa-exclamation-triangle fa-3x opacity-50"></i>
        </div>
      </div>
      <div class="card-footer bg-transparent">
        <a href="/rentals" class="text-white text-decoration-none">
          View Overdue <i class="fas fa-arrow-right"></i>
        </a>
      </div>
    </div>
  </div>
</div>

<div class="row mt-4">
  <div class="col-md-12">
    <div class="card">
      <div class="card-header bg-primary text-white">
        <h5 class="mb-0"><i class="fas fa-chart-line"></i> Quick Actions</h5>
      </div>
      <div class="card-body">
        <div class="row g-3">
          <% if (user.role === 'admin') { %>
          <div class="col-md-3">
            <a href="/vehicles/add" class="btn btn-outline-primary w-100">
              <i class="fas fa-plus-circle"></i> Add Vehicle
            </a>
          </div>
          <div class="col-md-3">
            <a href="/customers/add" class="btn btn-outline-success w-100">
              <i class="fas fa-user-plus"></i> Add Customer
            </a>
          </div>
          <% } %>
          <div class="col-md-3">
            <a href="/rentals/add" class="btn btn-outline-warning w-100">
              <i class="fas fa-file-contract"></i> New Rental
            </a>
          </div>
          <div class="col-md-3">
            <a href="/rentals" class="btn btn-outline-info w-100">
              <i class="fas fa-list"></i> View All Rentals
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Fetch dashboard statistics
async function loadStats() {
  try {
    const response = await fetch('/api/stats');
    const data = await response.json();
    document.getElementById('totalVehicles').textContent = data.totalVehicles || 0;
    document.getElementById('availableVehicles').textContent = data.availableVehicles || 0;
    document.getElementById('activeRentals').textContent = data.activeRentals || 0;
    document.getElementById('overdueRentals').textContent = data.overdueRentals || 0;
    <% if (user.role === 'admin') { %>
    document.getElementById('totalCustomers').textContent = data.totalCustomers || 0;
    <% } %>
  } catch (error) {
    console.error('Error loading stats:', error);
  }
}

loadStats();
</script>

<%- include('partials/footer') %>
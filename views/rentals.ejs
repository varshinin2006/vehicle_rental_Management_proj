<%- include('partials/header') %>

<div class="row mb-4">
  <div class="col">
    <h2><i class="fas fa-file-contract"></i> Rentals</h2>
  </div>
  <div class="col text-end">
    <a href="/rentals/add" class="btn btn-primary">
      <i class="fas fa-plus"></i> New Rental
    </a>
  </div>
</div>

<div class="card">
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead class="table-dark">
          <tr>
            <th>Rental ID</th>
            <th>Customer</th>
            <th>Vehicle</th>
            <th>Start Date</th>
            <th>End Date</th>
            <th>Amount</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% if (rentals.length === 0) { %>
            <tr>
              <td colspan="8" class="text-center">No rentals found</td>
            </tr>
          <% } else { %>
            <% rentals.forEach(rental => { %>
              <tr>
                <td><%= rental.rental_id %></td>
                <td><%= rental.customer_id ? rental.customer_id.name : 'N/A' %></td>
                <td>
                  <% if (rental.vehicle_id) { %>
                    <%= rental.vehicle_id.brand %> <%= rental.vehicle_id.model %>
                  <% } else { %>
                    N/A
                  <% } %>
                </td>
                <td><%= new Date(rental.start_date).toLocaleDateString() %></td>
                <td><%= new Date(rental.end_date).toLocaleDateString() %></td>
                <td>$<%= rental.total_amount %></td>
                <td>
                  <% if (rental.status === 'Active') { %>
                    <span class="badge bg-warning">Active</span>
                  <% } else if (rental.status === 'Completed') { %>
                    <span class="badge bg-success">Completed</span>
                  <% } else { %>
                    <span class="badge bg-danger">Overdue</span>
                  <% } %>
                </td>
                <td>
                  <% if (rental.status === 'Active' || rental.status === 'Overdue') { %>
                    <form action="/rentals/return/<%= rental._id %>" method="POST" class="d-inline">
                      <button type="submit" class="btn btn-sm btn-success" title="Return Vehicle">
                        <i class="fas fa-check"></i> Return
                      </button>
                    </form>
                  <% } %>
                  <a href="/rentals/invoice/<%= rental._id %>" class="btn btn-sm btn-primary" title="Download Invoice">
                    <i class="fas fa-file-pdf"></i> Invoice
                  </a>
                </td>
              </tr>
            <% }); %>
          <% } %>
        </tbody>
      </table>
    </div>
  </div>
</div>

<%- include('partials/footer') %>